#!/bin/sh
# Testsuite executor
set -e
set -x

# Include Travis virtualenv
if [ -f ~/virtualenv/python2.7/bin/activate ] ; then
    source ~/virtualenv/python2.7/bin/activate
fi

./manage.py validate
if [ "$CI_DATABASE" = sqlite ] ; then 
    ./ci/migrate-testing
fi
./manage.py syncdb --noinput
./manage.py migrate --traceback
coverage run --source=. ./manage.py test $CI_RUN_TESTS
