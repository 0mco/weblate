{% extends "base.html" %}
{% load i18n %}
{% load translations %}
{% load crispy_forms_tags %}

{% block content %}

{% if not user.is_authenticated %}
<p class="alert alert-info">
{% if demo_server %}
{% blocktrans %}This site runs <a href="{{ weblate_url }}">Weblate</a> demo server.{% endblocktrans %}
{% else %}
{% blocktrans %}This site runs <a href="{{ weblate_url }}">Weblate</a> for translating the software projects listed below.{% endblocktrans %}
{% endif %}
{% trans "You need to be logged in for translating, otherwise you can only make suggestions." %}
</p>
{% endif %}

{% whiteboard_messages %}


<ul class="nav nav-pills">
<li class="dropdown active">
  <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="views-title">
    "TODO" <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" id="views-menu">
    <li><a href="#projects" data-toggle="tab">{% trans "All projects" %}</a></li>
{% if user.is_authenticated %}
    <li><a href="#your-languages" data-toggle="tab">{% trans "Your languages" %}</a></li>
    <li><a href="#your-subscriptions" data-toggle="tab">{% trans "Your subscriptions" %}</a></li>
{% endif %}
    {% for componentlist in componentlists %}
    <li><a href="#list-{{ componentlist.slug }}" data-toggle="tab">{{ componentlist.name }}</a></li>
    {% endfor %}
  </ul>
</li>
<li><a href="#search" data-toggle="tab">{% trans "Search" %}</a></li>
<li><a href="#history" data-toggle="tab">{% trans "History" %}</a></li>
<li><a href="#activity" data-toggle="tab" data-load="activity" data-yearly="{% url 'yearly_activity' %}" data-monthly="{% url 'monthly_activity' %}">{% trans "Activity" %}</a></li>
<li><a href="#stats" data-toggle="tab">{% trans "Statistics" %}</a></li>
<li class="dropdown">
  <a class="dropdown-toggle" data-toggle="dropdown" href="#">
    {% trans "Tools" %} <span class="caret"></span>
  </a>
  <ul class="dropdown-menu">
    <li><a href="{% url 'languages' %}">{% trans "Languages summary" %}</a></li>
    <li><a href="{% url 'checks' %}">{% trans "Checks overview" %}</a></li>
    <li><a href="{% url 'data_root' %}">{% trans "Data export" %}</a></li>
    <li><a href="{% url 'widgets_root' %}">{% trans "Widgets" %}</a></li>
  </ul>
</li>
</ul>

<script>
$("#views-menu li a").click(function(){
  
  $("#views-title").html($(this).text()+' <span class="caret"></span>');
    
  });
</script>

<div class="tab-content">
{% if user.is_authenticated %}
<div class="tab-pane active" id="your-subscriptions">
{% if usersubscriptions %}
{% with usersubscriptions as translations and 2 as show_language and user.profile.hide_completed as hide_completed %}
{% include "list-translations.html" %}
{% endwith %}
{% else %}
{% with usersubscriptions as projects %}
{% include "list-projects.html" %}
{% endwith %}
<p class="help-block">{% trans "Choose your languages in preferences and you will get an overview here of available translations for those languages in your subscribed projects." %}</p>
{% endif %} {# usersubscriptions #}
<p>
    <a class="btn btn-default" href="{% url 'profile' %}#languages">{% trans "Manage your languages" %}</a>
    <a class="btn btn-default" href="{% url 'profile' %}#subscriptions">{% trans "Manage your subscriptions" %}</a>
</p>
</div>

<div class="tab-pane" id="your-languages">
{% if userlanguages %}
{% with userlanguages as translations and 2 as show_language and user.profile.hide_completed as hide_completed %}
{% include "list-translations.html" %}
{% endwith %}
{% else %}
<p class="help-block">{% trans "Choose your languages in preferences and you will get an overview here of available translations for those languages in all projects." %}</p>
{% endif %} {# userlanguages #}
<p><a class="btn btn-default" href="{% url 'profile' %}#languages">{% trans "Manage your languages" %}</a></p>
</div>


<div class="tab-pane" id="projects">

{% else %} {# user.is_authenticated #}
<div class="tab-pane active" id="projects">
{% endif %} {# user.is_authenticated #}

{% include "list-projects.html" %}

<p>
{% include "legend.html" %}
</p>

{% if offer_hosting %}
<p><a class="btn btn-default" href="{% url 'hosting' %}">{% trans "Ask for project hosting" %}</a>
{% endif %}
</div>

{% for componentlist in componentlists %}
    <div class="tab-pane" id="list-{{componentlist.slug}}">
    {% if userlanguages %}
    {% with userlanguages as translations and 2 as show_language and user.profile.hide_completed as hide_completed %}
    {% include "list-translations.html" %}
    {% endwith %}
    {% else %}
    {% with componentlist.get_components as projects %}
    {% include "list-projects.html" %}
    {% endwith %}
    <p class="help-block">{% trans "Choose your languages in preferences and you will get an overview here of available translations for those languages." %}</p>
    {% endif %} {# userlanguages #}
    <p><a class="btn btn-default" href="{% url 'profile' %}#languages">{% trans "Manage your languages" %}</a></p>
</div>{% endfor %}

<div class="tab-pane" id="search">

<form action="{% url 'search' %}" method="GET">
{{ search_form|crispy }}
<input type="submit" value="{% trans "Search" %}" class="btn btn-default" />
</form>

</div>

{% include "activity-tab.html" %}

<div class="tab-pane" id="stats">
<div class="container-fluid">
<div class="row">
<div class="col-lg-6">
<div class="panel panel-primary">
<div class="panel-heading"><h4 class="panel-title">{% trans "Most active translators" %}</h4></div>
<div class="panel-body">
<table class="table table-condensed">
<thead>
<tr>
<th>{% trans "User" %}</th>
<th>{% trans "Translated" %}</th>
</tr>
<tbody>
{% for u in top_translations %}
<tr>
<td>{{ u.get_user_display_link }}</td>
<td class="percent">{{ u.translated }}</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>
</div>


<div class="col-lg-6">
<div class="panel panel-primary">
<div class="panel-heading"><h4 class="panel-title">{% trans "Most active suggesters" %}</h4></div>
<div class="panel-body">
<table class="table table-condensed">
<thead>
<tr>
<th>{% trans "User" %}</th>
<th>{% trans "Suggested" %}</th>
</tr>
<tbody>
{% for u in top_suggestions %}
<tr>
<td>{{ u.get_user_display_link }}</td>
<td class="percent">{{ u.suggested }}</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>
</div>

</div>
</div>
</div>

<div class="tab-pane" id="history">
{% include "last-changes-content.html" %}
<a class="btn btn-link" href="{% url 'changes' %}?{{ last_changes_url }}">{% trans "Browse all changes" %}</a>
</div>

</div>

{% endblock %}
